---
name: safe-refactor
description: 指导小步、可验证的重构，降低引入 bug 风险。在用户要求重构、整理代码、或拆分大函数/大文件时使用。
---

# 安全重构

## 原则

- **小步**：一次只做一类改动，便于回滚和定位问题。
- **可验证**：每步后运行测试或手工验证，通过再继续。
- **不混改**：重构与功能修改分开提交，便于 code review 与 bisect。

## 推荐流程

1. **确定范围**：明确要重构的模块/函数/文件。
2. **保证绿**：当前测试全过（无测试则先做一次手工验证）。
3. **单步重构**：做一种改动（如重命名、提取函数、移动文件）。
4. **验证**：运行测试或关键路径验证。
5. **提交**：通过则提交，用 `refactor:` 开头的中文描述。
6. **重复**：回到 3，直到目标完成。

## 常见操作

- **重命名**：先改定义处，再改所有引用，最后跑测试。
- **提取函数/组件**：先提取并保持行为不变，再考虑参数与命名优化。
- **移动文件**：先更新 import/路径，再移动文件，确认构建与测试通过。
